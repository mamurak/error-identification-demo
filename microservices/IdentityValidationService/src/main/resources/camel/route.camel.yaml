- route:
    id: IdentityValidation-route
    from:
      id: from-3851
      uri: platform-http
      parameters:
        path: /
      steps:
        - log:
            id: log-3786
            message: "Evaluating Identity validation outcome.. ${body}"
        - choice:
            when:
              - simple: "${random(0,10)} > 3"
                steps:
                  - setBody:
                      simple: >
                        {
                          "customerId": "CUST-78901",
                          "status": "VERIFIED",
                          "identityType": "NATIONAL_ID",
                          "documentNumber": "XYZ1234567",
                          "expiryDate": "2030-12-31",
                          "fullName": "Ahmed Hassan",
                          "dateOfBirth": "1990-08-12",
                          "verificationScore": 95,
                          "timestamp": "2025-05-15T07:45:00Z"
                        }
              - simple: "${random(0,10)} <= 3"
                steps:
                  - setBody:
                      simple: >
                        {
                          "customerId": "CUST-45231",
                          "status": "FAILED",
                          "identityType": "PASSPORT",
                          "documentNumber": "P987654321",
                          "expiryDate": "2022-01-15",
                          "fullName": "Fatima Noor",
                          "dateOfBirth": "1985-11-22",
                          "failureReason": "Document expired",
                          "verificationScore": 60,
                          "timestamp": "2025-05-15T07:46:10Z"
                        }
               - simple: "${random(0,10)} <= 5"
                steps:
                  - setBody:
                      simple: >
                        {
                          "customerId": "CUST-45231",
                          "status": "FAILED",
                          "identityType": "PASSPORT",
                          "documentNumber": "P987654321",
                          "expiryDate": "2022-01-15",
                          "fullName": "John  Joe",
                          "dateOfBirth": "1985-11-22",
                          "failureReason": "Name does not match identity record",
                          "verificationScore": 60,
                          "timestamp": "2025-05-15T07:46:10Z"
                        }         
            otherwise:
              steps:
                - setBody:
                    simple: >
                      {
                        "error": "Unexpected error",
                        "message": "No valid branch executed",
                        "timestamp": "${date:now:yyyy-MM-dd'T'HH:mm:ss'Z'}"
                      }
        - log:
            id: log-3732
            message: body=${body}
        - setHeader:
            id: setHeader-2294
            expression:
              constant:
                expression: application/json
            name: Content-Type
