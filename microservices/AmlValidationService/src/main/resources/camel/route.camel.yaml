

- route:
    id: AmlValidation-route
    from:
      id: from-3851
      uri: platform-http
      parameters:
        path: /
      steps:
        - log:
            id: log-3786
            disabled: false
            message: "Evaluating AML validation outcome.. ${body}"
        - choice:
            when:
              - simple: "${random(0,10)} > 3"
                steps:
                  - setBody:
                      simple: >
                        {
                          "customerId": "CUST-${random(100000,999999)}",
                          "status": "PASS",
                          "message": "Risk Profile accepted",
                          "riskScore": ${random(1,30)},
                          "riskLevel": "LOW",
                          "matchedWatchlists": [],
                          "timestamp": "${date:now:yyyy-MM-dd'T'HH:mm:ss'Z'}"
                        }
              - simple: "${random(0,10)} <= 3"
                steps:
                  - setBody:
                      simple: >
                        {
                          "customerId": "CUST-${random(100000,999999)}",
                          "status": "FAIL",
                          "message": "Risk Profile Too High",
                          "riskScore": ${random(70,99)},
                          "riskLevel": "HIGH",
                          "matchedWatchlists": [
                            {
                              "type": "Sanctions",
                              "source": "OFAC",
                              "matchConfidence": "95%"
                            }
                          ],
                          "timestamp": "${date:now:yyyy-MM-dd'T'HH:mm:ss'Z'}"
                        }
            otherwise:
              steps:
                - setBody:
                    simple: >
                      {
                        "error": "Unexpected error",
                        "message": "No valid branch executed",
                        "timestamp": "${date:now:yyyy-MM-dd'T'HH:mm:ss'Z'}"
                      }
        - log:
            id: log-3732
            message: body=${body}
        - setHeader:
            id: setHeader-2294
            expression:
              constant:
                expression: application/json
            name: Content-Type
- routeConfiguration:
    id: routeConfiguration-1522
    intercept:
      - intercept:
          steps:
            - process:
                ref: messageProcessor
